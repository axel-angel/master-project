<!DOCTYPE HTML>
<html>
<head>
<script type="text/javascript" src="web/jquery-2.1.3.min.js"></script>
<script type="text/javascript" src="web/canvasjs.min.js"></script>
<script type="text/javascript" src="../lenet_mnist/save_t-sne_transfo-v2-test1_10k_ip1_i0-9a-e_1426785198.js"></script>
<script type="text/javascript">
window.onload = function () {
  var data = {};
  var legends = {};
  for (var i = -1; i < 10; ++i) {
    data[i] = [];
  };
  X.forEach(function (x) {
    var l = x.l;
    x.label = "<b>"+ l +"</b> (#"+ x.i +") ["+ x.src +" | "+ x.tr +"("+ x.v +")]<br/><img style='width:64px;height:64px;' src='data:image/jpeg;base64,"+ imgs[x.i] +"'/>";
    data[l].push(x);
    legends[l] = ""+ x.l;
  });

  var chart = new CanvasJS.Chart("chartContainer", {
    axisX: { minimum: -6, maximum: 6 },
    axisY: { minimum: -6, maximum: 6 },
    data: Object.keys(data).map(function (l) {
      return {
        type: "scatter",
        markerSize: 2,
        legendText: legends[l],
        showInLegend: "true",
        markerType: "circle",
        dataPoints: data[l],
      };
    }),
  });
  chart.render();

  // handle zoom with mouse wheel
  var lastwheel = new Date();
  $('#chartContainer').bind('wheel', function (e) {
    e.preventDefault();
    var now = new Date();
    if (now - lastwheel < 1000) return; // don't call it too often
    if (e.originalEvent.deltaY == 0) return; // ignore horizontal

    var dir = e.originalEvent.deltaY < 0 ? +1 : -1;
    var scale = dir > 0 ? 1/2 : 2;
    var subscale = dir > 0 ? +1/4 : -1/2;

    chart.options.data.forEach(function (d) {
      d.markerSize /= Math.sqrt(scale); // heuristic to avoid overlap, works!
    });
    var dx = chart.options.axisX.maximum - chart.options.axisX.minimum;
    var dy = chart.options.axisY.maximum - chart.options.axisY.minimum;
    chart.options.axisX.minimum += dx * subscale;
    chart.options.axisY.minimum += dy * subscale;
    chart.options.axisX.maximum -= dx * subscale;
    chart.options.axisY.maximum -= dy * subscale;
    chart.render()
    lastwheel = now;
  });

  // handle move with keyboard arrows
  $('body').keypress(function (e) {
    var dirx = 0;
    var diry = 0;
    if (e.keyCode == 39) dirx = +1;
    if (e.keyCode == 37) dirx = -1;
    if (e.keyCode == 38) diry = +1;
    if (e.keyCode == 40) diry = -1;

    if (dirx == 0 && diry == 0) return;
    var dx = chart.options.axisX.maximum - chart.options.axisX.minimum;
    var dy = chart.options.axisY.maximum - chart.options.axisY.minimum;
    chart.options.axisX.minimum += dx * dirx / 4;
    chart.options.axisY.minimum += dy * diry / 4;
    chart.options.axisX.maximum += dx * dirx / 4;
    chart.options.axisY.maximum += dy * diry / 4;
    chart.render();

    e.preventDefault();
  });
}
</script>
</head>
<body>
  <div id="chartContainer" style="height: 600px; width: 100%;">
  </div>
</body>
</html>
